# Cloud Dashboard 및 Service 테스트 결과

**테스트 일시**: 2026-01-20 18:00 KST
**테스트 환경**: GCP titanium-k3s Cluster (34.50.8.19)
**Kubernetes Version**: v1.34.3+k3s1

---

## 1. Cluster 상태

| 항목 | 상태 | 비고 |
|------|------|------|
| Master Node | Ready | titanium-k3s-master |
| Worker Node | Ready | titanium-k3s-worker-b35d |
| Namespaces | 8개 활성 | titanium-prod, monitoring, istio-system, argocd 등 |

---

## 2. Monitoring Stack 테스트 결과

### Prometheus
| 항목 | 결과 | 상세 |
|------|------|------|
| Health | **PASS** | Prometheus Server is Healthy |
| Ready | **PASS** | Prometheus Server is Ready |
| Active Targets (UP) | **17** | Monitoring 관련 Target 모두 정상 |
| Metrics Count | **2052** | 메트릭 수집 정상 |
| Application Targets | **DOWN (9)** | istio-proxy CrashLoopBackOff로 인한 장애 |

### Grafana
| 항목 | 결과 | 상세 |
|------|------|------|
| Health | **PASS** | database: ok |
| Version | 12.2.1 | 최신 버전 |

### Loki
| 항목 | 결과 | 상세 |
|------|------|------|
| Ready | **PASS** | ready 응답 확인 |
| Labels | **10개** | app, container, namespace, pod 등 정상 수집 |
| Promtail | **Running (2)** | 각 Node에서 정상 실행 |

### Kiali
| 항목 | 결과 | 상세 |
|------|------|------|
| Pod Status | **Running (1/1)** | kiali-5bdb67f48c-mnl6l |
| Istio Config | **정상** | VirtualService, DestinationRule 설정 확인 |

---

## 3. Istio 상태

| 컴포넌트 | 상태 | 비고 |
|---------|------|------|
| Istiod | Running (1/1) | istiod-7f6c4c7568-598cw |
| Ingress Gateway | Running (1/1) | istio-ingressgateway-56878bcf99-74ht4 |
| VirtualService | 1개 | prod-titanium-vs |
| DestinationRule | 3개 | mTLS 및 DB 연결 설정 |

---

## 4. Application Service 상태

| Service | Pod Status | Container Health | 문제 |
|---------|------------|------------------|------|
| API Gateway | CrashLoopBackOff (2) | Container 정상 시작 | istio-proxy 인증서 발급 실패 |
| Auth Service | CrashLoopBackOff (2) | Health Check 200 OK | istio-proxy 인증서 발급 실패 |
| User Service | 1 Running / 1 CrashLoop | Health Check 200 OK | 일부 정상 |
| Blog Service | CrashLoopBackOff (2) | Container 정상 시작 | Redis 연결 실패 + istio-proxy |
| PostgreSQL | Running (1/1) | pg_isready 성공 | 정상 |
| Redis | CrashLoopBackOff (1) | Container 정상 | istio-proxy 인증서 발급 실패 |

---

## 5. 장애 원인 분석

### Root Cause: istio-proxy Sidecar 인증서 발급 실패

```
error: failed to sign CSR: create certificate: rpc error: code = Unavailable
desc = "transport: Error while dialing: dial tcp 10.43.173.99:15012: connect: connection refused"
```

**원인**:
- istio-proxy가 Istiod(10.43.173.99:15012)에 CSR(Certificate Signing Request) 전송 실패
- 인증서 발급 실패로 mTLS 통신 불가
- Startup/Readiness Probe 실패로 CrashLoopBackOff 진입

**영향**:
- Application Container 자체는 정상 시작 (Health Check 200 OK 응답)
- istio-proxy 실패로 Pod가 Ready 상태가 되지 못함
- Service Mesh 통신 불가

---

## 6. 권장 조치

### 즉시 조치
1. **istio-proxy 재시작**: 영향받는 Pod 삭제 후 재생성
   ```bash
   kubectl rollout restart deployment -n titanium-prod
   ```

2. **Istiod 연결 확인**:
   ```bash
   kubectl exec -n titanium-prod <pod> -c istio-proxy -- curl -v istiod.istio-system:15012
   ```

### 근본 해결
1. Istiod Pod와 Application Pod 간 네트워크 정책 검토
2. Istio CA 인증서 갱신 상태 확인
3. istio-proxy 리소스 제한(CPU/Memory) 조정 검토

---

## 7. 테스트 요약

| 카테고리 | 통과 | 실패 | 비율 |
|----------|------|------|------|
| Monitoring Stack | 4/4 | 0/4 | 100% |
| Infrastructure (DB) | 1/1 | 0/1 | 100% |
| Application Services | 1/6 | 5/6 | 17% |
| Prometheus Targets | 17/26 | 9/26 | 65% |

**전체 결과**: Monitoring 인프라 정상, Application Service istio-proxy 장애로 부분 실패
